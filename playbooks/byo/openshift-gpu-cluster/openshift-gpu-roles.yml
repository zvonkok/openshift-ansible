---
- hosts: nodes
  vars:
    fixture_get_gpu_nodes:  True
    nv_pci_vendor_id:       0x10de
    pci_base_class_display: 0x030000
    pci_base_class_mask:    0xff0000

  roles:
    - role: openshift_all_nodes

- hosts: gpunodes-0
  vars:
    fixture_get_specific_kernel_version: True
    fixture_nvidia_container_runtime: True
    fixture_device_query: True

  roles:
     - role: openshift_gpu_nodes

- hosts: masters
  roles:
    - role: openshift_all_masters

- hosts: lonely_master
  vars:
    gpu_nodes: |
      {% set res = {} %}
      {% for host in groups['nodes'] %}
      {% if hostvars[host]['valid'] == "0" %}
      {% set x=res.__setitem__('nodename', hostvars[host]['ansible_nodename']) %}
      {% set x=res.__setitem__('gpuname', hostvars[host]['NV_GPU_NAME']) %}
      {% set x=res.__setitem__('invname', hostvars[host]['inventory_hostname']) %}
      {% endif %}
      {% endfor %}
      {{ res }}

  roles:
    - role: openshift_gpu_masters
